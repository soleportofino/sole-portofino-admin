<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sole Portofino - Analizler</title>
    <link rel="stylesheet" href="css/admin.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="sidebar-header">
            <h2>SOLE PORTOFINO</h2>
            <span class="admin-badge">Admin</span>
        </div>
        
        <nav class="sidebar-nav">
            <a href="dashboard.html" class="nav-item">
                <span class="icon">üìä</span>
                <span>Dashboard</span>
            </a>
            <a href="orders.html" class="nav-item">
                <span class="icon">üì¶</span>
                <span>Sipari≈üler</span>
                <span class="badge" id="new-orders-count">0</span>
            </a>
            <a href="products.html" class="nav-item">
                <span class="icon">üëú</span>
                <span>√úr√ºn Y√∂netimi</span>
            </a>
            <a href="customers.html" class="nav-item">
                <span class="icon">üë•</span>
                <span>M√º≈üteriler</span>
            </a>
            <a href="analytics.html" class="nav-item active">
                <span class="icon">üìà</span>
                <span>Analizler</span>
            </a>
            <a href="returns.html" class="nav-item">
                <span class="icon">‚Ü©Ô∏è</span>
                <span>ƒ∞adeler</span>
            </a>
            <a href="settings.html" class="nav-item">
                <span class="icon">‚öôÔ∏è</span>
                <span>Ayarlar</span>
            </a>
        </nav>
        
        <div class="sidebar-footer">
            <button class="logout-button" id="logout-button">
                <span class="icon">üö™</span>
                <span>√áƒ±kƒ±≈ü Yap</span>
            </button>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Header -->
        <header class="main-header">
            <h1>Analizler</h1>
            <div class="header-actions">
                <select class="period-select" id="global-period">
                    <option value="week">Bu Hafta</option>
                    <option value="month" selected>Bu Ay</option>
                    <option value="quarter">Bu √áeyrek</option>
                    <option value="year">Bu Yƒ±l</option>
                </select>
                <button class="btn-primary" onclick="exportReport()">
                    <span class="icon">üìä</span>
                    Rapor ƒ∞ndir
                </button>
                <div class="user-info">
                    <span id="user-email">admin@soleportofino.com</span>
                </div>
            </div>
        </header>

        <!-- Key Metrics -->
        <div class="analytics-kpi">
            <div class="kpi-card">
                <div class="kpi-header">
                    <h3>Gelir</h3>
                    <span class="kpi-change positive">+23.5%</span>
                </div>
                <p class="kpi-value">‚Ç∫487,250</p>
                <p class="kpi-comparison">Ge√ßen ay: ‚Ç∫394,800</p>
            </div>
            <div class="kpi-card">
                <div class="kpi-header">
                    <h3>Sipari≈ü Sayƒ±sƒ±</h3>
                    <span class="kpi-change positive">+18.2%</span>
                </div>
                <p class="kpi-value">342</p>
                <p class="kpi-comparison">Ge√ßen ay: 289</p>
            </div>
            <div class="kpi-card">
                <div class="kpi-header">
                    <h3>Ortalama Sipari≈ü</h3>
                    <span class="kpi-change positive">+4.7%</span>
                </div>
                <p class="kpi-value">‚Ç∫1,425</p>
                <p class="kpi-comparison">Ge√ßen ay: ‚Ç∫1,361</p>
            </div>
            <div class="kpi-card">
                <div class="kpi-header">
                    <h3>D√∂n√º≈ü√ºm Oranƒ±</h3>
                    <span class="kpi-change negative">-2.1%</span>
                </div>
                <p class="kpi-value">3.8%</p>
                <p class="kpi-comparison">Ge√ßen ay: 4.1%</p>
            </div>
        </div>

        <!-- Charts Row 1 -->
        <div class="charts-row">
            <div class="chart-card large">
                <div class="chart-header">
                    <h3>Satƒ±≈ü Trendi</h3>
                    <div class="chart-actions">
                        <button class="chart-btn active" onclick="updateSalesChart('revenue')">Gelir</button>
                        <button class="chart-btn" onclick="updateSalesChart('orders')">Sipari≈ü</button>
                    </div>
                </div>
                <canvas id="salesTrendChart"></canvas>
            </div>
            <div class="chart-card">
                <div class="chart-header">
                    <h3>Kategori Daƒüƒ±lƒ±mƒ±</h3>
                </div>
                <canvas id="categoryChart"></canvas>
            </div>
        </div>

        <!-- Charts Row 2 -->
        <div class="charts-row">
            <div class="chart-card">
                <div class="chart-header">
                    <h3>En √áok Satan √úr√ºnler</h3>
                </div>
                <div class="top-products-list">
                    <div class="product-item">
                        <span class="product-rank">1</span>
                        <div class="product-details">
                            <p class="product-name">Premium G√∂mlek</p>
                            <p class="product-sales">87 satƒ±≈ü</p>
                        </div>
                        <span class="product-revenue">‚Ç∫73,950</span>
                    </div>
                    <div class="product-item">
                        <span class="product-rank">2</span>
                        <div class="product-details">
                            <p class="product-name">Klasik Pantolon</p>
                            <p class="product-sales">64 satƒ±≈ü</p>
                        </div>
                        <span class="product-revenue">‚Ç∫76,800</span>
                    </div>
                    <div class="product-item">
                        <span class="product-rank">3</span>
                        <div class="product-details">
                            <p class="product-name">Yazlƒ±k Ceket</p>
                            <p class="product-sales">45 satƒ±≈ü</p>
                        </div>
                        <span class="product-revenue">‚Ç∫144,000</span>
                    </div>
                    <div class="product-item">
                        <span class="product-rank">4</span>
                        <div class="product-details">
                            <p class="product-name">Deri Kemer</p>
                            <p class="product-sales">123 satƒ±≈ü</p>
                        </div>
                        <span class="product-revenue">‚Ç∫49,200</span>
                    </div>
                    <div class="product-item">
                        <span class="product-rank">5</span>
                        <div class="product-details">
                            <p class="product-name">Spor Ayakkabƒ±</p>
                            <p class="product-sales">38 satƒ±≈ü</p>
                        </div>
                        <span class="product-revenue">‚Ç∫91,200</span>
                    </div>
                </div>
            </div>
            <div class="chart-card">
                <div class="chart-header">
                    <h3>M√º≈üteri Segmentleri</h3>
                </div>
                <canvas id="customerSegmentChart"></canvas>
            </div>
        </div>

        <!-- Traffic Sources -->
        <div class="chart-card full-width">
            <div class="chart-header">
                <h3>Trafik Kaynaklarƒ±</h3>
            </div>
            <div class="traffic-sources">
                <div class="traffic-item">
                    <div class="traffic-source">
                        <span class="traffic-icon">üîç</span>
                        <span>Organik Arama</span>
                    </div>
                    <div class="traffic-stats">
                        <div class="traffic-bar" style="width: 45%"></div>
                        <span class="traffic-percentage">45%</span>
                    </div>
                </div>
                <div class="traffic-item">
                    <div class="traffic-source">
                        <span class="traffic-icon">üì±</span>
                        <span>Sosyal Medya</span>
                    </div>
                    <div class="traffic-stats">
                        <div class="traffic-bar" style="width: 30%"></div>
                        <span class="traffic-percentage">30%</span>
                    </div>
                </div>
                <div class="traffic-item">
                    <div class="traffic-source">
                        <span class="traffic-icon">üìß</span>
                        <span>E-posta</span>
                    </div>
                    <div class="traffic-stats">
                        <div class="traffic-bar" style="width: 15%"></div>
                        <span class="traffic-percentage">15%</span>
                    </div>
                </div>
                <div class="traffic-item">
                    <div class="traffic-source">
                        <span class="traffic-icon">üîó</span>
                        <span>Direkt</span>
                    </div>
                    <div class="traffic-stats">
                        <div class="traffic-bar" style="width: 10%"></div>
                        <span class="traffic-percentage">10%</span>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Scripts -->
    <script src="supabase-config.js"></script>
    <script src="supabase-only-auth.js"></script>
    <script src="auth-guard.js"></script>
    <script>
        // Initialize auth check on page load
        document.addEventListener('DOMContentLoaded', async () => {
            // Auth guard will handle authentication automatically
            
            // Initialize charts
            initCharts();
        });

        function initCharts() {
            // Sales Trend Chart
            const salesCtx = document.getElementById('salesTrendChart').getContext('2d');
            new Chart(salesCtx, {
                type: 'line',
                data: {
                    labels: ['1', '5', '10', '15', '20', '25', '30'],
                    datasets: [{
                        label: 'Gelir',
                        data: [12000, 19000, 15000, 25000, 22000, 30000, 28000],
                        borderColor: '#4CAF50',
                        tension: 0.1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false
                }
            });

            // Category Chart
            const categoryCtx = document.getElementById('categoryChart').getContext('2d');
            new Chart(categoryCtx, {
                type: 'doughnut',
                data: {
                    labels: ['G√∂mlekler', 'Pantolonlar', 'Ceketler', 'Aksesuarlar'],
                    datasets: [{
                        data: [35, 25, 30, 10],
                        backgroundColor: ['#4CAF50', '#2196F3', '#FF9800', '#E91E63']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false
                }
            });

            // Customer Segment Chart
            const segmentCtx = document.getElementById('customerSegmentChart').getContext('2d');
            new Chart(segmentCtx, {
                type: 'bar',
                data: {
                    labels: ['VIP', 'D√ºzenli', 'Yeni', 'Pasif'],
                    datasets: [{
                        label: 'M√º≈üteri Sayƒ±sƒ±',
                        data: [89, 234, 145, 67],
                        backgroundColor: '#2196F3'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false
                }
            });
        }

        function updateSalesChart(type) {
            alert('Grafik g√ºncelleniyor: ' + type);
        }

        function exportReport() {
            alert('Analiz raporu indiriliyor...');
        }
    </script>
</body>
</html>